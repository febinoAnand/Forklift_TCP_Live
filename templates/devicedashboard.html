<!DOCTYPE html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Device Dashboard</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- favicon
		============================================ -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="static/img/favicon.ico"
    />
    <!-- Google Fonts
		============================================ -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900"
      rel="stylesheet"
    />
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/bootstrap.min.css" />
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/font-awesome.min.css" />
    <!-- owl.carousel CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/owl.carousel.css" />
    <link rel="stylesheet" href="static/css/owl.theme.css" />
    <link rel="stylesheet" href="static/css/owl.transitions.css" />
    <!-- meanmenu CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/meanmenu/meanmenu.min.css" />
    <!-- animate CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/animate.css" />
    <!-- normalize CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/normalize.css" />
    <!-- mCustomScrollbar CSS
		============================================ -->
    <link
      rel="stylesheet"
      href="static/css/scrollbar/jquery.mCustomScrollbar.min.css"
    />
    <!-- jvectormap CSS
		============================================ -->
    <link
      rel="stylesheet"
      href="static/css/jvectormap/jquery-jvectormap-2.0.3.css"
    />
    <!-- notika icon CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/notika-custom-icon.css" />
    <!-- wave CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/wave/waves.min.css" />
    <!-- main CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/main.css" />
    <!-- style CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/cssstyles.css" />
    <!-- responsive CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/responsive.css" />
    <!-- modernizr JS
		============================================ -->
    <script src="static/js/vendor/modernizr-2.8.3.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> 
      <link rel="stylesheet" href="../static/css/dashboardBars.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAcErlQMQKVQmqlnSmo9lIgEHp5e9MIjTEY"></script>
    <style>
      #map {
        height: 400px;
        width: 100%;
      }
    </style>

    <style>
      .status {
        width: 100px;
        text-align: center;
        padding-top: 5px;
        padding-bottom: 5px;
        border-radius: 100px;
      }
      .active-1 {
        background-color: rgba(97, 240, 109, 0.8); 
      }
      .idle {
        background-color: rgba(255, 193, 7, 0.8); 
      }
      .inactive {
        background-color: rgba(225, 99, 132, 0.8);
      }
      .alert {
        background-color: rgba(255, 0, 0, 0.8);
      }
    </style>        

  </head>

  <body onload="startUpdateTable('{{device.device_id}}')">
    {% load mathfilters %}

    <!--[if lt IE 8]>
      <p class="browserupgrade">
        You are using an <strong>outdated</strong> browser. Please
        <a href="http://browsehappy.com/">upgrade your browser</a> to improve
        your experience.
      </p>
    <![endif]-->
    <!-- Start Header Top Area -->
    <div class="header-top-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
            <div class="logo-area">
              <a href="#"
                ><p style="color: white; font-size: 25px; font-weight: bold;">INNOSPACE</p></a
              >
            </div>
          </div>
          <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
            <div class="header-top-menu">
              <ul class="nav navbar-nav notika-top-nav">
                <li class="nav-item">
                  <a href="/listpage" role="button" aria-expanded="false" class="nav-link dropdown-toggle">
                    <span class="glyphicon glyphicon-arrow-left"></span>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/reportpage/?deviceID={{device.device_id}}" method="GET" role="button" aria-expanded="false" class="nav-link dropdown-toggle">
                    <span class="glyphicon glyphicon-save-file"></span>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/logout" role="button"><span class="glyphicon glyphicon-log-out"></span></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br /><br />
    <!-- End Header Top Area -->
    <div class="google-map-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="google-map-single" style="height: 150px">
              <h3>Today Status</h3><br>
              <div class="progress">
                
                  <!-- <div class="segment " style="background-color: red; width: 10%;">
                      <div class="tooltip">Inactive : 2 Hours</div>
                  </div>
                  <div class="segment" style="background-color: lightblue; width: 10%;">
                      <div class="tooltip">Active : 3 Hours</div>
                  </div>
                  <div class="segment" style="background-color: lightcoral; width: 10%;">
                      
                      <div class="tooltip">Idle : 4 Hours</div>
                  </div>
                  <div class="segment" style="background-color: lightgreen; width: 10%;">
                    <div class="tooltip">Idle : 4 Hours</div>
                </div>
                <div class="segment" style="background-color: lightgreen; width: 10%;">
                  <div class="tooltip">Idle : 4 Hours</div>
              </div> -->
            </div>
            <div class="ruler">
              <div class="ruler-cell">
                <span class="zero">0</span>
                <span class="number">1</span>
              </div>
              <div class="ruler-cell"><span class="number">2</span></div>
              <div class="ruler-cell"><span class="number">3</span></div>
              <div class="ruler-cell"><span class="number">4</span></div>
              <div class="ruler-cell"><span class="number">5</span></div>
              <div class="ruler-cell"><span class="number">6</span></div>
              <div class="ruler-cell"><span class="number">7</span></div>
              <div class="ruler-cell"><span class="number">8</span></div>
              <div class="ruler-cell"><span class="number">9</span></div>
              <div class="ruler-cell"><span class="number">10</span></div>
              <div class="ruler-cell"><span class="number">11</span></div>
              <div class="ruler-cell"><span class="number">12</span></div>
              <div class="ruler-cell"><span class="number">13</span></div>
              <div class="ruler-cell"><span class="number">14</span></div>
              <div class="ruler-cell"><span class="number">15</span></div>
              <div class="ruler-cell"><span class="number">16</span></div>
              <div class="ruler-cell"><span class="number">17</span></div>
              <div class="ruler-cell"><span class="number">18</span></div>
              <div class="ruler-cell"><span class="number">19</span></div>
              <div class="ruler-cell"><span class="number">20</span></div>
              <div class="ruler-cell"><span class="number">21</span></div>
              <div class="ruler-cell"><span class="number">22</span></div>
              <div class="ruler-cell"><span class="number">23</span></div>
              <div class="ruler-cell"><span class="number">24</span></div>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br /><br><br>
    <!-- Form Element area Start-->
    <div class="form-element-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
            <div class="form-element-list" style="width: 100%; height: 485px">
              <div class="basic-tb-hd">
                <h2>Vehicles Details</h2>
              </div>
              <table id="data-table-basic" class="table table-striped">
                <tr>
                  <th>Device ID</th>
                  <td id="currentdeviceID">{{device.device_id}}</td>
                </tr>
                <tr>
                  <th>Vehicle Name</th>
                  <td>{{device.vehicle_name}}</td>
                </tr>
                <tr>
                  <th>Manufracture</th>
                  <td>{{device.manufacturer}}</td>
                </tr>
                <tr>
                  <th>Vehicle ID</th>
                  <td>{{device.vehicle_id}}</td>
                </tr>
                <tr>
                  <th>Device Model</th>
                  <td>{{device.device_model}}</td>
                </tr>
                <tr>
                  <th>Hardware Version</th>
                  <td>{{device.hardware_version}}</td>
                </tr>
                <tr>
                  <th>Software Version</th>
                  <td>{{device.software_version}}</td>
                </tr>
                <tr>
                  <th>Driver</th>
                  <td>{{device.driver}}</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
            <div class="form-element-list">
              <div class="basic-tb-hd">
                <h2>GPS Speed</h2>
              </div>
              <div
                id="gps-data-conta"
                class="gauge"
                style="width: 300px; --rotation: {{gpsData.speed | div:'25' | mul:'180'}}deg; --color:#566573; --background:#e9ecef;"
              >
                <div class="percentage"></div>
                <div class="mask"></div>
                <span id="gps_speed" class="value">{{gpsData.speed}} Km/Hr</span>
              </div>
              <br />
              <br />
              <div class="basic-tb-hd">
                <h2>EXT Speed</h2>
              </div>
              <div
                id="ext-data-conta" class="gauge" style="width: 300px; --rotation: {{extData.speed | div:'25' | mul:'180' }}deg; --color:#643873; --background:#e9ecef;"
              >
                <div class="percentage"></div>
                <div class="mask"></div>
                <span id="ext_speed" class="value">{{extData.speed}} Km/Hr</span>
              </div>
              <br />
            </div>
          </div>
          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
            <div class="form-element-list" style="width: 100%; height: 485px">
              <div class="basic-tb-hd">
                <h2>Live Status</h2>
              </div>
              <br />
              <table id="data-table-basic" class="table table-striped">
                <tr>
                  <th>Status</th>
                     <td id="status_view" class="inactive">Inactive</td>
                    </div>
                  </td>
                </tr>
                <tr>
                  <th>Ignition State</th>
                  {%if gpsData.ignition %}
                  <td id="ignition_state">ON</td>
                  {% else %}
                  <td  id="ignition_state">OFF</td>
                  {%endif%}
                </tr>
                <tr>
                  <th>Movement State</th>
                  {%if gpsData.movementState %}
                  <td id="movementState_view">Moving</td>
                  {% else %}
                  <td id="movementState_view">Not Moving</td>
                  {%endif%}
                </tr>
                <tr>
                  <th>GSM Operator</th>
                  <td id="gsm_operator">{{gsmData.gsmOperatorCode}}</td>
                </tr>
                <tr>
                  <th>GSM Signal</th>
                  <td id="gsm_signal">
                    <!-- <i style="font-size:24px" class="fa">&#xf012;</i> -->
                    {{gsmData.gsmSignal}}
                  </td>
                </tr>
                <tr>
                  <th>GSM Area</th>
                  <td id="gsm_area">{{gsmData.gsmAreaCode}}</td>
                </tr>
              </table>
              <div id="ignition_state" style="display: none;">OFF</div>
              <div id="movementState_view" style="display: none;">Stationary</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br /><br />
    <!-- Google Map area End-->
    <div class="google-map-area">
      <div class="container">
        <div class="row">
          <div
            class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
            style="margin-bottom: 30px"
          >
            <div class="google-map-single" style="height: 450px">
              <div id="map"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Google Map area End-->
    <!-- Form Element area End-->
    <div class="form-element-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
            <div id="ext-data-container" class="form-element-list">
              <div class="basic-tb-hd">
                <h2>Battery Capacity</h2>
              </div>
              <div
                id="ext_batt"
                class="gauge"
                style="width: 300px; --rotation: {{ extData.batt_power | div:'10000' | mul:'180'}}deg; --color:#76C9E2; --background:#e9ecef;"
              >
                <div class="percentage"></div>
                <div class="mask"></div>
                <span id="battery_power" class="value">{{extData.batt_power}} Watts</span>
              </div>
              <br /><br />
              <table id="data-table-basic" class="table table-striped">
                <tr>
                  <th>Battery</th>
                  <td id="live_cap_widget">
                      <div class="battery-bar">
                          <div id="battery_capacity" class="battery-fill-1"></div>
                      </div>
                  </td>
              </tr>
                <tr>
                  <th>Battery Voltage</th>
                  <td id="battery_voltage">{{extData.batt_voltage}}</td>
                </tr>
                <tr>
                  <th>Battery Amps</th>
                  <td id="battery_amps">{{extData.batt_amp}}</td>
                </tr>
                <tr>
                  <th>Watt Hour</th>
                  <td id="watt_hour">{{extData.watt_hr}}</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
            <div class="form-element-list">
              <div class="basic-tb-hd">
                <h2>GPS</h2>
              </div>
              <div id="gps-data-container" class="email-round-nock">
                <div class="circle">
                  <div id="gps-speed" class="text" style="color: white; font-size: 12px">
                    Satellite Details
                  </div>
                </div>
                <div class="circle" style="color: white; font-size: 12px">
                  <div class="text">Top Speed: <span id="top-speed"></span></div>
              </div>
                <div class="circle" style="color: white; font-size: 12px">
                  <div id="gps_time" class="text">Duration: {{gpsData.time}}</div>
                </div>
              </div>
              <br />
              <div class="form-element-list" style="width: 100%; height: 255px">
                <table id="data-table-basic" class="table table-striped">
                  <tr>
                    <th>Satellite Connected</th>
                    <td id="satellite_connect">{{gpsData.satellite}}</td>
                  </tr>
                  <tr>
                    <th>LONGITUDE</th>
                    <td id="latitude_view">{{gpsData.longitude}}</td>
                  </tr>
                  <tr>
                    <th>LATITUDE</th>
                    <td id="longitude_view">{{gpsData.latitude}}</td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
            <div class="form-element-list">
              <div class="basic-tb-hd">
                <h2>Speed of Vehicles</h2>
              </div>
              <canvas id="myChart" width="400" height="505"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br /><br />
    <!-- Form Element area End-->
    <div class="form-element-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
            <div class="form-element-list">
              <div class="basic-tb-hd" style="margin-bottom: 60px;">
                <h2>Utilization Hour</h2>
                <p>The total Utilization Hour for a week</p>
              </div>
              <table class="graph" id="barChart">
                <thead>
                    <tr >
                        <th scope="col">Day</th>
                        <th scope="col">Active</th>
                        <th scope="col">Inactive</th>
                        <th scope="col">Idle</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class= "bar-monday">
                        <th scope="row">Monday</th>
                        <td>
                            <div class="bar" style="height: 332px;">
                              <div class="inactive"></div>
                              <div class="idle"></div>
                              <div class="active"></div>
                            </div>
                        </td>
                    </tr>
                    <tr class="bar-tuesday">
                        <th scope="row">Tuesday</th>
                        <td>
                            <div class="bar" style="height: 332px;background-color:#FA766E;">
                              <div class="inactive"></div>
                              <div class="idle"></div>
                              <div class="active"></div>
                            </div>
                        </td>
                    </tr>
                    <tr class="bar-wednesday" >
                      <th scope="row">Wednesday</th>
                      <td>
                          <div class="bar" style="height: 332px;">
                              <div class="inactive"></div>
                              <div class="idle"></div>
                              <div class="active"></div>
                          </div>
                      </td>
                  </tr>
                  
                  <tr class="bar-thursday" >
                      <th scope="row">Thursday</th>
                      <td>
                          <div class="bar" style="height: 332px;">
                            <div class="inactive"></div>
                            <div class="idle"></div>
                            <div class="active"></div>
                          </div>
                      </td>
                  </tr>
                  
                  <tr class="bar-friday">
                      <th scope="row">Friday</th>
                      <td>
                          <div class="bar" style="height: 332px;">
                            <div class="inactive"></div>
                            <div class="idle"></div>
                            <div class="active"></div>
                          </div>
                      </td>
                  </tr>
                  
                  <tr class="bar-saturday">
                      <th scope="row">Saturday</th>
                      <td>
                          <div class="bar" style="height: 332px;">
                            <div class="inactive"></div>
                            <div class="idle"></div>
                            <div class="active"></div>
                          </div>
                      </td>
                  </tr>
                </tbody>
            </table>            
            </div>
          </div>
          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
            <div class="form-element-list">
              <div class="basic-tb-hd">
                <h2>State of Vehicles</h2>
              </div>
              <div style="width: 100%; height: 400px; padding-top: 20px">
                <canvas
                  id="myPieChart"
                  width="320"
                  style="
                    display: block;
                    box-sizing: border-box;
                    height: 320px;
                    width: 320px;
                  "
                ></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br />
    <br />

    <!-- Data Table area Start-->
    <div class="data-table-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="data-table-list">
              <div class="basic-tb-hd">
                <h2>GPS Table</h2>
              </div>
              <div class="table-responsive">
                <table id="data-table-basic" class="table table-striped">
                  <thead>
                    <tr>
                      <th>S/NO</th>
                      <th>DATE</th>
                      <th>TIME</th>
                      <th>DISTANCE</th>
                      <th>SPEED</th>
                      <th>LATITUDE</th>
                      <th>LONGITUDE</th>
                    </tr>
                  </thead>
                  <tbody id="gps_data_table"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br /><br />
    <!-- Table area End-->

    <!-- Data Table area Start-->
    <div class="data-table-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="data-table-list">
              <div class="basic-tb-hd">
                <h2>Vehicle Parameter</h2>
              </div>
              <div class="table-responsive">
                <table id="data-table-basic" class="table table-striped">
                  <thead>
                    <tr>
                      <th>S/NO</th>
                      <th>DATE</th>
                      <th>TIME</th>
                      <th>ODOMETER DISTANCE</th>
                      <th>SPEED</th>
                      <th>WATT HR</th>
                      <th>BATT VOLTAGE</th>
                      <th>BATT AMP</th>
                      <th>BATT POWER</th>
                      <th>BATT CHARGE</th>
                    </tr>
                  </thead>
                  <tbody id="external_data_table"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br /><br />
    <!-- Table area End-->
    <!-- Start Footer area-->
    <div class="footer-copyright-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="footer-copy-right">
              <p>Copyright Â© 2024 . All rights reserved.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Footer area-->
    <!-- jquery
		============================================ -->
    <script src="static/js/vendor/jquery-1.12.4.min.js"></script>
    <!-- bootstrap JS
		============================================ -->
    <script src="static/js/bootstrap.min.js"></script>
    <!-- wow JS
		============================================ -->
    <script src="static/js/wow.min.js"></script>
    <!-- price-slider JS
		============================================ -->
    <script src="static/js/jquery-price-slider.js"></script>
    <!-- owl.carousel JS
		============================================ -->
    <script src="static/js/owl.carousel.min.js"></script>
    <!-- scrollUp JS
		============================================ -->
    <script src="static/js/jquery.scrollUp.min.js"></script>
    <!-- meanmenu JS
		============================================ -->
    <script src="static/js/meanmenu/jquery.meanmenu.js"></script>
    <!-- counterup JS
		============================================ -->
    <script src="static/js/counterup/jquery.counterup.min.js"></script>
    <script src="static/js/counterup/waypoints.min.js"></script>
    <script src="static/js/counterup/counterup-active.js"></script>
    <!-- mCustomScrollbar JS
		============================================ -->
    <script src="static/js/scrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <!-- jvectormap JS
		============================================ -->
    <script src="static/js/jvectormap/jquery-jvectormap-2.0.2.min.js"></script>
    <script src="static/js/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="static/js/jvectormap/jvectormap-active.js"></script>
    <!-- sparkline JS
		============================================ -->
    <script src="static/js/sparkline/jquery.sparkline.min.js"></script>
    <script src="static/js/sparkline/sparkline-active.js"></script>
    <!-- sparkline JS
		============================================ -->
    <script src="static/js/flot/jquery.flot.js"></script>
    <script src="static/js/flot/jquery.flot.resize.js"></script>
    <script src="static/js/flot/curvedLines.js"></script>
    <script src="static/js/flot/flot-active.js"></script>
    <!-- knob JS
		============================================ -->
    <script src="static/js/knob/jquery.knob.js"></script>
    <script src="static/js/knob/jquery.appear.js"></script>
    <script src="static/js/knob/knob-active.js"></script>
    <!--  wave JS
		============================================ -->
    <script src="static/js/wave/waves.min.js"></script>
    <script src="static/js/wave/wave-active.js"></script>
    <!--  todo JS
		============================================ -->
    <script src="static/js/todo/jquery.todo.js"></script>
    <!-- plugins JS
		============================================ -->
    <script src="static/js/plugins.js"></script>
    <!--  Chat JS
		============================================ -->
    <script src="static/js/chat/moment.min.js"></script>
    <script src="static/js/chat/jquery.chat.js"></script>

    <!-- main JS
		============================================ -->
    <script src="static/js/main.js"></script>

    <script src="static/js/custom.js"></script>

    <script src="static/js/webfort.js"></script>
    <script>
      var deviceID = document.getElementById("currentdeviceID").innerText;
      function initMap() {
          const map = new google.maps.Map(document.getElementById("map"), {
              center: { lat: 0, lng: 0 },
              zoom: 2,
          });
  
          const markers = [];
          const lines = [];
  
          function addMarker(location) {
              const icon = {
                  path: google.maps.SymbolPath.CIRCLE,
                  scale: 7,
                  fillColor: 'blue',
                  fillOpacity: 1,
                  strokeWeight: 0,
              };
  
              const marker = new google.maps.Marker({
                  position: location,
                  map: map,
              });
              markers.push(marker);
          }
  
          function addLine(location1, location2) {
    if (location1.lat === 0 && location1.lng === 0 || location2.lat === 0 && location2.lng === 0) {
        return;
    }

    const line = new google.maps.Polyline({
        path: [location1, location2],
        geodesic: true,
        strokeColor: 'Red',
        strokeOpacity: 1.0,
        strokeWeight: 2
    });
    lines.push(line);
    line.setMap(map);
}
  
function fetchDataAndUpdateMap() {
    fetch("/api/get-gps-data/?deviceID="+deviceID)
        .then((response) => response.json())
        .then((data) => {
            markers.forEach((marker) => marker.setMap(null));
            markers.length = 0;
            lines.forEach((line) => line.setMap(null));
            lines.length = 0;

            const lastTwentyData = data.slice(-20).filter(item => item.latitude !== 0 || item.longitude !== 0);

            let previousLocation = null;

            lastTwentyData.forEach((item, index) => {
                const location = { lat: item.latitude, lng: item.longitude };
                if (index === lastTwentyData.length - 1) {
                    addMarker(location);
                }
                if (index < lastTwentyData.length - 1) {
                    const nextLocation = { lat: lastTwentyData[index + 1].latitude, lng: lastTwentyData[index + 1].longitude };
                    addLine(location, nextLocation);
                }
            });

            const bounds = new google.maps.LatLngBounds();
            lastTwentyData.forEach((item) => {
                const location = new google.maps.LatLng(item.latitude, item.longitude);
                bounds.extend(location);
            });

            if (bounds.getCenter().lat() !== 0 || bounds.getCenter().lng() !== 0) {
                map.fitBounds(bounds);
            }
        })
        .catch((error) => {
            console.error("Error fetching data:", error);
        });
}

          fetchDataAndUpdateMap();
  
          setInterval(fetchDataAndUpdateMap, 5000);
      }
  </script>
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAcErlQMQKVQmqlnSmo9lIgEHp5e9MIjTE&callback=initMap"
    ></script>
    <script>
      var deviceID = document.getElementById("currentdeviceID").innerText;
      $(document).ready(function () {
        let lastEXTData = { 
          movementState: true 
        };
        let isVehicleMovingOrNot = false;
        function updateExtData() {
          $.ajax({
            url: "ext-data/?deviceID="+deviceID,
            type: "GET",
            success: function (data) {
              // $('#ext-data-table').html(JSON.stringify(data));
             // console.log("Received DAta -> ", data);
             let datacount = data.length;
        console.log(data[datacount - 1]);
        
        let lastEXTData = data[datacount - 1];

        if (lastEXTData["batt_voltage"]) {
            $('#battery_voltage').text(lastEXTData.batt_voltage);
        }
        if (lastEXTData["batt_amp"]) {
            $('#battery_amps').text(lastEXTData.batt_amp);
        }
        if (lastEXTData["watt_hr"]) {
            $('#watt_hour').text(lastEXTData.watt_hr);
        }
        if (lastEXTData["speed"]) {
            $('#ext_speed').text(lastEXTData.speed +"Km/Hr" );
        }
        if (lastEXTData["batt_power"]) {
            $('#battery_power').text(lastEXTData.batt_power + "Watt");
        }
        if (lastEXTData["batt_capacity"]) {
            $('#battery_capacity').text(lastEXTData.batt_capacity);
        }
        let extSpeed = lastEXTData["speed"];
        let movementState = (extSpeed > 0) ? "Moving" : "Not Moving";
        isVehicleMovingOrNot = (extSpeed > 0) ? true : false;
        $('#movementState_view').text(movementState);
  
    },
    error: function (xhr, textStatus, errorThrown) {
        console.log("Error:", errorThrown);
            },
          });
        }
function updateGpsData() {
    $.ajax({
        url: "gps-data/?deviceID="+deviceID,
        type: "GET",
        success: function(data) {
            let datacount = data.length;
            let lastGPSData = data[datacount - 1];

            if (lastGPSData["ignition"]) {
                $('#ignition_state').text("ON");
            } else {
                $('#ignition_state').text("OFF");
            }

            if (lastGPSData["ignition"] && isVehicleMovingOrNot) {
                if ($('#status_view').text() != "Active") {
                    $('#status_view').text("Active");
                    $('#status_view').removeClass();
                    $('#status_view').addClass("status active-1");
                }
            } else if (lastGPSData["ignition"] && !isVehicleMovingOrNot) {
                if ($('#status_view').text() != "Idle") {
                    $('#status_view').text("Idle");
                    $('#status_view').removeClass();
                    $('#status_view').addClass("status idle");
                }
            } else if (!lastGPSData["ignition"] && !isVehicleMovingOrNot) {
                if ($('#status_view').text() != "Inactive") {
                    $('#status_view').text("Inactive");
                    $('#status_view').removeClass();
                    $('#status_view').addClass("status inactive");
                }
            } else {
                if ($('#status_view').text() != "Alert") {
                    $('#status_view').text("Alert");
                    $('#status_view').removeClass();
                    $('#status_view').addClass("status alert");
                }
            }

        // if (lastGPSData["ignition"]) {
        //   if (lastGPSData["movementState"]) {
        //       $('#status_view').text("Active").removeClass("inactive").addClass("active");
        //   } else {
        //      $('#status_view').text("Idle").removeClass("inactive").addClass("idle");
        //   }
        // } else {
        //     $('#status_view').text("Inactive").removeClass("active idle").addClass("inactive");
        // }

        if (lastGPSData["gsmOperatorCode"]) {
            $('#gsm_operator').text(lastGPSData.gsmOperatorCode);
        }

        if (lastGPSData["gsmSignal"]) {
            $('#gsm_signal').text(lastGPSData.gsmSignal);
        }

        if (lastGPSData["gsmAreaCode"]) {
            $('#gsm_area').text(lastGPSData.gsmAreaCode);
        }

        if (lastGPSData["speed"]) {
            $('#gps_speed').text( lastGPSData.speed + ' Km/Hr');
        }

        if (lastGPSData["time"]) {
            $('#gps_time').text('Current Time: ' + lastGPSData.time);
        }

        if (lastGPSData["satellite"]) {
            $('#satellite_connect').text(lastGPSData.satellite);
        }

        if (lastGPSData["latitude"]) {
            $('#latitude_view').text(lastGPSData.latitude);
        }

        if (lastGPSData["longitude"]) {
            $('#longitude_view').text(lastGPSData.longitude);
        }

    },
    error: function (xhr, textStatus, errorThrown) {
        console.log("Error:", errorThrown);
    }
});
        }
        updateGpsData();
        updateExtData();

        setInterval(function () {
          updateGpsData();
          updateExtData();
        }, 5000);
      });
    </script>
     
    <script>
      
      $(document).ready(function () {
          function updateExtData() {
              $.ajax({
                  url: "ext-data/?deviceID="+deviceID,
                  type: "GET",
                  success: function (data) {
                      let datacount = data.length;
                      let lastEXTData = data[datacount - 1];
                      if (lastEXTData["batt_capacity"]) {
                          let batt_capacity = lastEXTData.batt_capacity;
                          updateBatteryBar(batt_capacity);
                      }
                  },
                  error: function (xhr, textStatus, errorThrown) {
                      console.log("Error:", errorThrown);
                  },
              });
          }

          function updateBatteryBar(batt_capacity) {
              let widthPercentage = (batt_capacity / 5) * 100;
              $('#battery_capacity').css('width', widthPercentage + '%');
          }
          updateExtData();
          setInterval(updateExtData, 5000);
      });
</script>
<script>
   document.addEventListener("DOMContentLoaded", function() {
    function updateGauge() {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', "gps-data/?deviceID=" + deviceID, true);
      xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            var data = JSON.parse(xhr.responseText);
            var datacount = data.length;
            var lastGPSData = data[datacount - 1];
            //console.log(lastGPSData.speed);
            document.getElementById('gps-data-conta').style.setProperty('--rotation', (lastGPSData.speed / 25 * 180) + 'deg');
          } else {
            console.log('Error:', xhr.statusText);
          }
        }
      };
      xhr.send();
    }

    updateGauge();
    setInterval(updateGauge, 5000);
  });
  </script>
<script>
function updateGauge() {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', "ext-data/?deviceID=" + deviceID, true);
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          var data = JSON.parse(xhr.responseText);
          var datacount = data.length;
          var lastEXTData = data[datacount - 1];
          //console.log(lastEXTData.speed);
          //console.log(lastEXTData.batt_power);
          document.getElementById('ext-data-conta').style.setProperty('--rotation', (lastEXTData.speed / 25 * 180) + 'deg');
          document.getElementById('ext_batt').style.setProperty('--rotation', (lastEXTData.batt_power / 10000 * 180) + 'deg');
        } else {
          console.log('Error:', xhr.statusText);
        }
      }
    };
    xhr.send();
  }

  updateGauge();
  setInterval(updateGauge, 5000);
</script>
<script>
  $(document).ready(function() {
      let topSpeed = 0;

      function updateTopSpeed() {
          $.ajax({
              url: "gps-data/?deviceID=" + deviceID,
              type: 'GET',
              success: function(data) {
                  let newTopSpeed = calculateTopSpeed(data);
                  if (newTopSpeed > topSpeed) {
                      topSpeed = newTopSpeed;
                      $('#top-speed').text(topSpeed + " Km/Hr");
                  }
              },
              error: function(xhr, textStatus, errorThrown) {
                  console.log('Error:', errorThrown);
              }
          });
      }

      function calculateTopSpeed(data) {
          let maxSpeed = 0;
          for (let i = 0; i < data.length; i++) {
              let speed = data[i].speed;
              if (speed > maxSpeed) {
                  maxSpeed = speed;
              }
          }
          return maxSpeed;
      }

      updateTopSpeed();
      setInterval(updateTopSpeed, 5000);
  });
</script>
</body>
</html>