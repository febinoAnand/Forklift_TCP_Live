<!DOCTYPE html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>History Page</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- favicon
		============================================ -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="static/img/favicon.ico"
    />
    <!-- Google Fonts
		============================================ -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900"
      rel="stylesheet"
    />
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/bootstrap.min.css" />
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/font-awesome.min.css" />
    <!-- owl.carousel CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/owl.carousel.css" />
    <link rel="stylesheet" href="static/css/owl.theme.css" />
    <link rel="stylesheet" href="static/css/owl.transitions.css" />
    <!-- meanmenu CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/meanmenu/meanmenu.min.css" />
    <!-- animate CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/animate.css" />
    <!-- normalize CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/normalize.css" />
    <!-- mCustomScrollbar CSS
		============================================ -->
    <link
      rel="stylesheet"
      href="static/css/scrollbar/jquery.mCustomScrollbar.min.css"
    />
    <!-- jvectormap CSS
		============================================ -->
    <link
      rel="stylesheet"
      href="static/css/jvectormap/jquery-jvectormap-2.0.3.css"
    />
    <!-- notika icon CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/notika-custom-icon.css" />
    <!-- wave CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/wave/waves.min.css" />
    <!-- main CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/main.css" />
    <!-- style CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/cssstyles.css" />
    <!-- responsive CSS
		============================================ -->
    <link rel="stylesheet" href="static/css/responsive.css" />
    <!-- modernizr JS
		============================================ -->
    <script src="static/js/vendor/modernizr-2.8.3.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> 
      <link rel="stylesheet" href="../static/css/dashboardBars.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAcErlQMQKVQmqlnSmo9lIgEHp5e9MIjTEY"></script>
    <style>
      #map {
        height: 400px;
        width: 100%;
      }
    </style>

    <style>
      .status {
        width: 100px;
        text-align: center;
        padding-top: 5px;
        padding-bottom: 5px;
        border-radius: 100px;
      }
      .active-1 {
        background-color: rgba(97, 240, 109, 0.8); 
      }
      .idle {
        background-color: rgba(255, 193, 7, 0.8); 
      }
      .inactive {
        background-color: rgba(225, 99, 132, 0.8);
      }
      .alert {
        background-color: rgba(255, 0, 0, 0.8);
      }
    </style>        

  </head>

  <body>
    {% load mathfilters %}

    <!--[if lt IE 8]>
      <p class="browserupgrade">
        You are using an <strong>outdated</strong> browser. Please
        <a href="http://browsehappy.com/">upgrade your browser</a> to improve
        your experience.
      </p>
    <![endif]-->
    <!-- Start Header Top Area -->
    <div class="header-top-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
            <div class="logo-area">
              <a href="/devicedashboard?device_id={{deviceID}}" method="GET"
                ><p style="color: white; font-size: 25px; font-weight: bold;">INNOSPACE</p></a
              >
            </div>
          </div>
          <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
            <div class="header-top-menu">
              <ul class="nav navbar-nav notika-top-nav">
                <li class="nav-item">
                  <a href="/devicedashboard?device_id={{deviceID}}" method="GET" role="button" aria-expanded="false" class="nav-link dropdown-toggle">
                    <span class="glyphicon glyphicon-arrow-left"></span>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/logout" role="button"><span class="glyphicon glyphicon-log-out"></span></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br /><br />
    <div class="notika-status-area">
      <div class="container">
          <div class="row">
              <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
                  <div class="wb-traffic-inner notika-shadow sm-res-mg-t-30 tb-res-mg-t-30">
                    <label for="datepicker">Select a date:</label>
                    <input type="date" id="datepicker" name="datepicker">&nbsp&nbsp
                    <label for="fromTime">From :</label>
                    <input type="time" id="fromTime">&nbsp&nbsp

                    <label for="toTime">To :</label>
                    <input type="time" id="toTime">&nbsp&nbsp
                    
                    <button id="showButton">Show</button>
                </div>
              </div>
          </div>
      </div>
  </div>
  <br /><br />
    <!-- End Header Top Area -->
    <div class="google-map-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="google-map-single" style="height: 150px">
              <h3>Status</h3><br>
              <div class="progress">
                {% for gpsState in stateTiming %}
               
                  
                  <div class="segment " style="background-color: {%if gpsState.state == 'Idle'%} rgba(255, 206, 86, 1) {%elif gpsState.state == 'Active'%} rgba(54, 162, 235, 1) {%elif gpsState.state == 'Inactive'%} rgba(255, 99, 132, 1)  {%endif%}; width: {{gpsState.percent}}%;">
                      <div class="tooltip">{{gpsState.state}} : {{gpsState.timediff}} Seconds</div>
                  </div>
                {% endfor %}
                  <!-- <div class="segment " style="background-color: red; width: 10%;">
                      <div class="tooltip">Inactive : 2 Hours</div>
                  </div>
                  <div class="segment" style="background-color: lightblue; width: 10%;">
                      <div class="tooltip">Active : 3 Hours</div>
                  </div>
                  <div class="segment" style="background-color: lightcoral; width: 10%;">
                      
                      <div class="tooltip">Idle : 4 Hours</div>
                  </div>
                  <div class="segment" style="background-color: lightgreen; width: 10%;">
                    <div class="tooltip">Idle : 4 Hours</div>
                </div>
                <div class="segment" style="background-color: lightgreen; width: 10%;">
                  <div class="tooltip">Idle : 4 Hours</div>
              </div> -->
            </div>
            <div class="ruler">
              <div class="ruler-cell">
                <span class="zero">0</span>
                <span class="number">1</span>
              </div>
              <div class="ruler-cell"><span class="number">2</span></div>
              <div class="ruler-cell"><span class="number">3</span></div>
              <div class="ruler-cell"><span class="number">4</span></div>
              <div class="ruler-cell"><span class="number">5</span></div>
              <div class="ruler-cell"><span class="number">6</span></div>
              <div class="ruler-cell"><span class="number">7</span></div>
              <div class="ruler-cell"><span class="number">8</span></div>
              <div class="ruler-cell"><span class="number">9</span></div>
              <div class="ruler-cell"><span class="number">10</span></div>
              <div class="ruler-cell"><span class="number">11</span></div>
              <div class="ruler-cell"><span class="number">12</span></div>
              <div class="ruler-cell"><span class="number">13</span></div>
              <div class="ruler-cell"><span class="number">14</span></div>
              <div class="ruler-cell"><span class="number">15</span></div>
              <div class="ruler-cell"><span class="number">16</span></div>
              <div class="ruler-cell"><span class="number">17</span></div>
              <div class="ruler-cell"><span class="number">18</span></div>
              <div class="ruler-cell"><span class="number">19</span></div>
              <div class="ruler-cell"><span class="number">20</span></div>
              <div class="ruler-cell"><span class="number">21</span></div>
              <div class="ruler-cell"><span class="number">22</span></div>
              <div class="ruler-cell"><span class="number">23</span></div>
              <div class="ruler-cell"><span class="number">24</span></div>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br /><br><br>
    <!-- Form Element area Start-->
    <div class="form-element-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
            <div class="form-element-list" style="width: 100%; height: 485px">
              <div class="basic-tb-hd">
                <h2>Vehicles Details</h2>
              </div>
              <table id="data-table-basic" class="table table-striped">
                <tr>
                  <th>Device ID</th>
                  <td id="currentdeviceID">{{device.device_id}}</td>
                </tr>
                <tr>
                  <th>Vehicle Name</th>
                  <td>{{device.vehicle_name}}</td>
                </tr>
                <tr>
                  <th>Manufracture</th>
                  <td>{{device.manufacturer}}</td>
                </tr>
                <tr>
                  <th>Vehicle ID</th>
                  <td>{{device.vehicle_id}}</td>
                </tr>
                <tr>
                  <th>Device Model</th>
                  <td>{{device.device_model}}</td>
                </tr>
                <tr>
                  <th>Hardware Version</th>
                  <td>{{device.hardware_version}}</td>
                </tr>
                <tr>
                  <th>Software Version</th>
                  <td>{{device.software_version}}</td>
                </tr>
                <tr>
                  <th>Driver</th>
                  <td>{{device.driver}}</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
            <div class="form-element-list">
              <div class="basic-tb-hd">
                <h2>State of Vehicles</h2>
              </div>
              <div style="width: 100%; height: 400px; padding-top: 20px">
                <canvas
                  id="myPieChart"
                  width="320"
                  style="
                    display: block;
                    box-sizing: border-box;
                    height: 320px;
                    width: 320px;
                  "
                ></canvas>
              </div>
            </div>
          </div>
          <!-- <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
            <div class="form-element-list">
              <div class="basic-tb-hd">
                <h2>GPS Speed</h2>
              </div>
              <div
                id="gps-data-conta"
                class="gauge"
                style="width: 300px; --rotation: {{gpsData.speed | div:'25' | mul:'180'}}deg; --color:#566573; --background:#e9ecef;"
              >
                <div class="percentage"></div>
                <div class="mask"></div>
                <span id="gps_speed" class="value">{{gpsData.speed}} Km/Hr</span>
              </div>
              <br />
              <br />
              <div class="basic-tb-hd">
                <h2>EXT Speed</h2>
              </div>
              <div
                id="ext-data-conta" class="gauge" style="width: 300px; --rotation: {{extData.speed | div:'25' | mul:'180' }}deg; --color:#643873; --background:#e9ecef;"
              >
                <div class="percentage"></div>
                <div class="mask"></div>
                <span id="ext_speed" class="value">{{extData.speed}} Km/Hr</span>
              </div>
              <br />
            </div>
          </div>
          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
            <div class="form-element-list" style="width: 100%; height: 485px">
              <div class="basic-tb-hd">
                <h2>Live Status</h2>
              </div>
              <br />
              <table id="data-table-basic" class="table table-striped">
                <tr>
                  <th>Status</th>
                     <td id="status_view" class="inactive">Inactive</td>
                    </div>
                  </td>
                </tr>
                <tr>
                  <th>Ignition State</th>
                  {%if gpsData.ignition %}
                  <td id="ignition_state">ON</td>
                  {% else %}
                  <td  id="ignition_state">OFF</td>
                  {%endif%}
                </tr>
                <tr>
                  <th>Movement State</th>
                  {%if gpsData.movementState %}
                  <td id="movementState_view">Moving</td>
                  {% else %}
                  <td id="movementState_view">Not Moving</td>
                  {%endif%}
                </tr>
                <tr>
                  <th>GSM Operator</th>
                  <td id="gsm_operator">{{gsmData.gsmOperatorCode}}</td>
                </tr>
                <tr>
                  <th>GSM Signal</th>
                  <td id="gsm_signal">
                     <i style="font-size:24px" class="fa">&#xf012;</i> 
                    {{gsmData.gsmSignal}}
                  </td>
                </tr>
                <tr>
                  <th>GSM Area</th>
                  <td id="gsm_area">{{gsmData.gsmAreaCode}}</td>
                </tr>
              </table>
              <div id="ignition_state" style="display: none;">OFF</div>
              <div id="movementState_view" style="display: none;">Stationary</div>
            </div>
          </div> -->
        </div>
      </div>
    </div>
    <br /><br />
    <!-- Google Map area End-->
    <div class="google-map-area">
      <div class="container">
        <div class="row">
          <div
            class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
            style="margin-bottom: 30px"
          >
            <div class="google-map-single" style="height: 450px">
              <div id="map"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Google Map area End-->
    <!-- Form Element area End-->
    <!-- <div class="form-element-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
            <div id="ext-data-container" class="form-element-list">
              <div class="basic-tb-hd">
                <h2>Battery Capacity</h2>
              </div>
              <div
                id="ext_batt"
                class="gauge"
                style="width: 300px; --rotation: {{ extData.batt_power | div:'10000' | mul:'180'}}deg; --color:#76C9E2; --background:#e9ecef;"
              >
                <div class="percentage"></div>
                <div class="mask"></div>
                <span id="battery_power" class="value">{{extData.batt_power}} Watts</span>
              </div>
              <br /><br />
              <table id="data-table-basic" class="table table-striped">
                <tr>
                  <th>Battery</th>
                  <td id="live_cap_widget">
                      <div class="battery-bar">
                          <div id="battery_capacity" class="battery-fill-1"></div>
                      </div>
                  </td>
              </tr>
                <tr>
                  <th>Battery Voltage</th>
                  <td id="battery_voltage">{{extData.batt_voltage}}</td>
                </tr>
                <tr>
                  <th>Battery Amps</th>
                  <td id="battery_amps">{{extData.batt_amp}}</td>
                </tr>
                <tr>
                  <th>Watt Hour</th>
                  <td id="watt_hour">{{extData.watt_hr}}</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
            <div class="form-element-list">
              <div class="basic-tb-hd">
                <h2>GPS</h2>
              </div>
              <div id="gps-data-container" class="email-round-nock">
                <div class="circle">
                  <div id="gps-speed" class="text" style="color: white; font-size: 12px">
                    Satellite Details
                  </div>
                </div>
                <div class="circle" style="color: white; font-size: 12px">
                  <div class="text">Top Speed: <span id="top-speed"></span></div>
              </div>
                <div class="circle" style="color: white; font-size: 12px">
                  <div id="gps_time" class="text">Duration: {{gpsData.time}}</div>
                </div>
              </div>
              <br />
              <div class="form-element-list" style="width: 100%; height: 255px">
                <table id="data-table-basic" class="table table-striped">
                  <tr>
                    <th>Satellite Connected</th>
                    <td id="satellite_connect">{{gpsData.satellite}}</td>
                  </tr>
                  <tr>
                    <th>LONGITUDE</th>
                    <td id="latitude_view">{{gpsData.longitude}}</td>
                  </tr>
                  <tr>
                    <th>LATITUDE</th>
                    <td id="longitude_view">{{gpsData.latitude}}</td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-6">
            <div class="form-element-list">
              <div class="basic-tb-hd">
                <h2>Speed of Vehicles</h2>
              </div>
              <canvas id="myChart" width="400" height="505"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br /><br /> -->
    <!-- Form Element area End-->
    <div class="form-element-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-8 col-sm-8 col-xs-8">
            <div class="form-element-list">
              <div class="basic-tb-hd" style="margin-bottom: 60px;">
                <h2>Utilization Hour</h2>
                <p>The total Utilization Hour for a week</p>
              </div>
              <table class="graph" id="barChart">
                <thead>
                    <tr >
                        <th scope="col">Day</th>
                        <th scope="col">Active</th>
                        <th scope="col">Inactive</th>
                        <th scope="col">Idle</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class= "bar-monday">
                        <th scope="row">Monday</th>
                        <td>
                            <div class="bar" style="height: 332px;">
                              <div class="inactive"></div>
                              <div class="idle"></div>
                              <div class="active"></div>
                            </div>
                        </td>
                    </tr>
                    <tr class="bar-tuesday">
                        <th scope="row">Tuesday</th>
                        <td>
                            <div class="bar" style="height: 332px;background-color:#FA766E;">
                              <div class="inactive"></div>
                              <div class="idle"></div>
                              <div class="active"></div>
                            </div>
                        </td>
                    </tr>
                    <tr class="bar-wednesday" >
                      <th scope="row">Wednesday</th>
                      <td>
                          <div class="bar" style="height: 332px;">
                              <div class="inactive"></div>
                              <div class="idle"></div>
                              <div class="active"></div>
                          </div>
                      </td>
                  </tr>
                  
                  <tr class="bar-thursday" >
                      <th scope="row">Thursday</th>
                      <td>
                          <div class="bar" style="height: 332px;">
                            <div class="inactive"></div>
                            <div class="idle"></div>
                            <div class="active"></div>
                          </div>
                      </td>
                  </tr>
                  
                  <tr class="bar-friday">
                      <th scope="row">Friday</th>
                      <td>
                          <div class="bar" style="height: 332px;">
                            <div class="inactive"></div>
                            <div class="idle"></div>
                            <div class="active"></div>
                          </div>
                      </td>
                  </tr>
                  
                  <tr class="bar-saturday">
                      <th scope="row">Saturday</th>
                      <td>
                          <div class="bar" style="height: 332px;">
                            <div class="inactive"></div>
                            <div class="idle"></div>
                            <div class="active"></div>
                          </div>
                      </td>
                  </tr>
                </tbody>
            </table>            
            </div>
          </div>
        </div>
      </div>
    </div>
    <br />
    <br />

    <!-- Data Table area Start-->
    <div class="data-table-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="data-table-list">
              <div class="basic-tb-hd">
                <h2>GPS Table</h2>
              </div>
              <div class="table-responsive">
                <table id="data-table-basic" class="table table-striped">
                  <thead>
                    <tr>
                      <th>S/NO</th>
                      <th>DATE</th>
                      <th>TIME</th>
                      <th>DISTANCE</th>
                      <th>SPEED</th>
                      <th>LATITUDE</th>
                      <th>LONGITUDE</th>
                    </tr>
                  </thead>
                  <tbody id="gps_data_table"></tbody>
                </table>
                <div class="pagination" id="gps-pagination-links">
                  <span class="step-links">
                      {% if GPSpage.has_previous %}
                          <a href="?page=1">&laquo; first</a>
                          <a href="?page={{ GPSpage.previous_page_number }}">&#9664;</a>
                      {% endif %}
              
                      <span class="current">
                          Page {{ GPSpage.number }} of {{ GPSpage.paginator.num_pages }}
                      </span>
              
                      {% if GPSpage.has_next %}
                          <a href="?page={{ GPSpage.next_page_number }}">&#9654;</a>
                          <a href="?page={{ GPSpage.paginator.num_pages }}">last &#9658;</a>
                      {% endif %}
                  </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
    <br /><br />
    <!-- Table area End-->

    <!-- Data Table area Start-->
    <div class="data-table-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="data-table-list">
              <div class="basic-tb-hd">
                <h2>Vehicle Parameter</h2>
              </div>
              <div class="table-responsive">
                <table id="data-table-basic" class="table table-striped">
                  <thead>
                    <tr>
                      <th>S/NO</th>
                      <th>DATE</th>
                      <th>TIME</th>
                      <th>ODOMETER DISTANCE</th>
                      <th>SPEED</th>
                      <th>WATT HR</th>
                      <th>BATT VOLTAGE</th>
                      <th>BATT AMP</th>
                      <th>BATT POWER</th>
                      <th>BATT CHARGE</th>
                    </tr>
                  </thead>
                  <tbody id="external_data_table"></tbody>
                </table>
                <div class="pagination" id="ext-pagination-links">
                  <span class="step-links">
                      {% if EXTpage.has_previous %}
                          <a href="?page=1">&laquo; first</a>
                          <a href="?page={{ EXTpage.previous_page_number }}">previous</a>
                      {% endif %}
              
                      <span class="current">
                          Page {{ EXTpage.number }} of {{ EXTpage.paginator.num_pages }}
                      </span>
              
                      {% if EXTpage.has_next %}
                          <a href="?page={{ EXTpage.next_page_number }}">next</a>
                          <a href="?page={{ EXTpage.paginator.num_pages }}">last &raquo;</a>
                      {% endif %}
                  </span>
              </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br /><br />
    <!-- Table area End-->
    <!-- Start Footer area-->
    <div class="footer-copyright-area">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="footer-copy-right">
              <p>Copyright © 2024 . All rights reserved.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Footer area-->
    <!-- jquery
		============================================ -->
    <script src="static/js/vendor/jquery-1.12.4.min.js"></script>
    <!-- bootstrap JS
		============================================ -->
    <script src="static/js/bootstrap.min.js"></script>
    <!-- wow JS
		============================================ -->
    <script src="static/js/wow.min.js"></script>
    <!-- price-slider JS
		============================================ -->
    <script src="static/js/jquery-price-slider.js"></script>
    <!-- owl.carousel JS
		============================================ -->
    <script src="static/js/owl.carousel.min.js"></script>
    <!-- scrollUp JS
		============================================ -->
    <script src="static/js/jquery.scrollUp.min.js"></script>
    <!-- meanmenu JS
		============================================ -->
    <script src="static/js/meanmenu/jquery.meanmenu.js"></script>
    <!-- counterup JS
		============================================ -->
    <script src="static/js/counterup/jquery.counterup.min.js"></script>
    <script src="static/js/counterup/waypoints.min.js"></script>
    <script src="static/js/counterup/counterup-active.js"></script>
    <!-- mCustomScrollbar JS
		============================================ -->
    <script src="static/js/scrollbar/jquery.mCustomScrollbar.concat.min.js"></script>
    <!-- jvectormap JS
		============================================ -->
    <script src="static/js/jvectormap/jquery-jvectormap-2.0.2.min.js"></script>
    <script src="static/js/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="static/js/jvectormap/jvectormap-active.js"></script>
    <!-- sparkline JS
		============================================ -->
    <script src="static/js/sparkline/jquery.sparkline.min.js"></script>
    <script src="static/js/sparkline/sparkline-active.js"></script>
    <!-- sparkline JS
		============================================ -->
    <script src="static/js/flot/jquery.flot.js"></script>
    <script src="static/js/flot/jquery.flot.resize.js"></script>
    <script src="static/js/flot/curvedLines.js"></script>
    <script src="static/js/flot/flot-active.js"></script>
    <!-- knob JS
		============================================ -->
    <script src="static/js/knob/jquery.knob.js"></script>
    <script src="static/js/knob/jquery.appear.js"></script>
    <script src="static/js/knob/knob-active.js"></script>
    <!--  wave JS
		============================================ -->
    <script src="static/js/wave/waves.min.js"></script>
    <script src="static/js/wave/wave-active.js"></script>
    <!--  todo JS
		============================================ -->
    <script src="static/js/todo/jquery.todo.js"></script>
    <!-- plugins JS
		============================================ -->
    <script src="static/js/plugins.js"></script>
    <!--  Chat JS
		============================================ -->
    <script src="static/js/chat/moment.min.js"></script>
    <script src="static/js/chat/jquery.chat.js"></script>

    <!-- main JS
		============================================ -->
    <script src="static/js/main.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
          const ctx = document.getElementById('myPieChart').getContext('2d');
          let myPieChart;
          var deviceID = document.getElementById("currentdeviceID").innerText;
  
          const updatePieChart = async (selectedDate, startTime, endTime) => {
              try {
                  const response = await fetch(`/get_today_gps_date_data/?deviceID={{device}}&date=${selectedDate}&startTime=${startTime}&endTime=${endTime}`);
                  if (!response.ok) {
                      throw new Error('Network response was not ok');
                  }
  
                  const data = await response.json();
                  let activeHours = 0, inactiveHours = 0, idleHours = 0;
  
                  if (data.length === 0) {
                      inactiveHours = 24;
                  } else {
                      data.forEach(entry => {
                          switch (entry.state) {
                              case "Active":
                                  activeHours += entry.duration;
                                  break;
                              case "Inactive":
                                  inactiveHours += entry.duration;
                                  break;
                              case "Idle":
                                  idleHours += entry.duration;
                                  break;
                              case "Alert":
                                  inactiveHours += entry.duration;
                                  break;
                          }
                      });
                  }
  
                  myPieChart.data.datasets[0].data = [activeHours, inactiveHours, idleHours];
                  myPieChart.update();
              } catch (error) {
                  console.error('Error fetching or parsing data:', error);
                  myPieChart.data.datasets[0].data = [0, 24, 0];
                  myPieChart.update();
              }
          };
  
          myPieChart = new Chart(ctx, {
              type: 'pie',
              data: {
                  labels: ['Active Hours', 'Inactive Hours', 'Idle Hours'],
                  datasets: [{
                      label: 'Today',
                      data: [0, 0, 0],
                      backgroundColor: [
                          'rgba(54, 162, 235, 0.8)',
                          'rgba(255, 99, 132, 0.8)',
                          'rgba(255, 206, 86, 0.8)'
                      ],
                      borderColor: [
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 99, 132, 1)',
                          'rgba(255, 206, 86, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  responsive: true
              }
          });
  
          document.getElementById('showButton').addEventListener('click', async () => {
              const selectedDate = document.getElementById('datepicker').value;
              const startTime = document.getElementById('fromTime').value;
              const endTime = document.getElementById('toTime').value;
              updatePieChart(selectedDate, startTime, endTime);
          });
      });
  </script>  
<script>
  var deviceID = document.getElementById("currentdeviceID").innerText;

  document.getElementById('showButton').addEventListener('click', async () => {
      const selectedDate = document.getElementById('datepicker').value;
      const startTime = document.getElementById('fromTime').value;
      const endTime = document.getElementById('toTime').value;
      resetPreviousResults();
      fetchDataAndUpdate(selectedDate, startTime, endTime);
  });

  function resetPreviousResults() {
      var barElements = document.querySelectorAll('.bar');
      barElements.forEach(bar => {
          var activeElement = bar.querySelector('.active');
          activeElement.style.height = '0';
          activeElement.textContent = '';
          activeElement.style.display = 'none';

          var idleElement = bar.querySelector('.idle');
          idleElement.style.height = '0';
          idleElement.textContent = '';
          idleElement.style.display = 'none';

          var inactiveElement = bar.querySelector('.inactive');
          inactiveElement.style.height = '0';
          inactiveElement.textContent = '';
          inactiveElement.style.display = 'none';
      });
  }

  function updateBarChart(data) {
      const selectedDate = document.getElementById('datepicker').value;
      const selectedDay = new Date(selectedDate).toLocaleDateString('en-US', { weekday: 'long' });
      const selectedData = data[selectedDay];

      if (!selectedData) {
          console.error(`Data not available for ${selectedDay}.`);
          return;
      }

      var utilizationData = selectedData;
      var row = document.querySelector(`.bar-${selectedDay.toLowerCase()}`);
      if (row) {
          var bar = row.querySelector('.bar');
          if (bar) {
              var totalActive = parseFloat(utilizationData['Active']);
              var totalIdle = parseFloat(utilizationData['Idle']);
              var totalInactive = 24 - (totalActive + totalIdle);

              var activeElement = bar.querySelector('.active');
              var activeHours = totalActive > 0 ? totalActive : 0;
              var activePixel = (activeHours / 24) * 332;
              activeElement.style.height = `${activePixel}px`;
              activeElement.textContent = activeHours.toFixed(1);
              activeElement.style.backgroundColor = '#6EC7FA';
              activeElement.style.display = activePixel > 0 ? 'block' : 'none';

              var idleElement = bar.querySelector('.idle');
              var idleHours = parseFloat(utilizationData['Idle']);
              var idlePixel = (idleHours / 24) * 332;
              idleElement.style.height = `${idlePixel}px`;
              idleElement.textContent = idleHours.toFixed(1);
              idleElement.style.backgroundColor = '#FAFA6E';
              idleElement.style.display = idlePixel > 0 ? 'block' : 'none';

              var inactiveElement = bar.querySelector('.inactive');
              var inactivePixel = (totalInactive / 24) * 332;
              inactiveElement.style.height = `${inactivePixel}px`;
              inactiveElement.textContent = totalInactive.toFixed(1);
              inactiveElement.style.backgroundColor = '#FA766E';
              inactiveElement.style.display = inactivePixel > 0 ? 'block' : 'none';
          } else {
              console.error(`Bar not found for ${selectedDay}.`);
          }
      } else {
          console.error(`Row for ${selectedDay} not found.`);
      }
  }

  function fetchDataAndUpdate(selectedDate, startTime, endTime) {
      const url = `/get_utilization_date_hours/?deviceID={{device}}&date=${selectedDate}&startTime=${startTime}&endTime=${endTime}`;
      fetch(url)
          .then(response => {
              if (!response.ok) {
                  throw new Error('Network response was not ok');
              }
              return response.json();
          })
          .then(data => updateBarChart(data))
          .catch(error => console.error('Error fetching data:', error));
  }
</script>
<!-- <script>
document.addEventListener('DOMContentLoaded', function() {
    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart;
    var deviceID = document.getElementById("currentdeviceID").innerText;

    function updateChart(selectedDate) {
        $.ajax({
            url: `/get_last_date_data/?deviceID={{deviceID}}&date=${selectedDate}`,
            success: function(data) {
                var gpsData = data.gps_data.map(item => item.speed);
                var extData = data.ext_data.map(item => item.speed);
                var labels = data.gps_data.map(item => item.time);

                myChart.data.labels = labels;
                myChart.data.datasets[0].data = gpsData;
                myChart.data.datasets[1].data = extData;

                myChart.update();
            }
        });
    }

    myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                    label: 'GPS-Speed',
                    data: [],
                    borderColor: 'red',
                    borderWidth: 1
                },
                {
                    label: 'EXT-Speed',
                    data: [],
                    borderColor: 'blue',
                    borderWidth: 1
                }
            ]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    document.getElementById('showButton').addEventListener('click', function() {
        var selectedDate = document.getElementById('datepicker').value;
        updateChart(selectedDate);
    });
});
</script> -->
<script>
  document.getElementById('showButton').addEventListener('click', async () => {
      const selectedDate = document.getElementById('datepicker').value;
      const startTime = document.getElementById('fromTime').value;
      const endTime = document.getElementById('toTime').value;
      fetchDataAndUpdateMap(selectedDate, startTime, endTime);
  });

  function fetchDataAndUpdateMap(selectedDate, startTime, endTime) {
      const deviceID = document.getElementById("currentdeviceID").innerText;
      
      fetch(`/get-gps-date-data/?deviceID={{device}}&date=${selectedDate}&startTime=${startTime}&endTime=${endTime}`)
      .then(response => {
              if (!response.ok) {
                  throw new Error('Network response was not ok');
              }
              return response.json();
          })
          .then(data => updateMap(data))
          .catch(error => console.error('Error fetching data:', error));
  }

  function updateMap(data) {
      const map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 0, lng: 0 },
          zoom: 2,
      });

      const markers = [];
      const lines = [];

      function addMarker(location) {
          if (location.lat === 0 && location.lng === 0) {
              return;
          }

          const marker = new google.maps.Marker({
              position: location,
              map: map,
          });
          markers.push(marker);
      }

      function addLine(location1, location2) {
          if (location1.lat === 0 && location1.lng === 0 || location2.lat === 0 && location2.lng === 0) {
              return;
          }

          const line = new google.maps.Polyline({
              path: [location1, location2],
              geodesic: true,
              strokeColor: 'Red',
              strokeOpacity: 1.0,
              strokeWeight: 2
          });
          lines.push(line);
          line.setMap(map);
      }

      markers.forEach((marker) => marker.setMap(null));
      markers.length = 0;
      lines.forEach((line) => line.setMap(null));
      lines.length = 0;

      if (data.length > 0) {
          const lastLocation = { lat: data[data.length - 1].latitude, lng: data[data.length - 1].longitude };
          addMarker(lastLocation);
          data.forEach((item, index) => {
              if (index < data.length - 1) {
                  const location = { lat: item.latitude, lng: item.longitude };
                  const nextLocation = { lat: data[index + 1].latitude, lng: data[index + 1].longitude };
                  addLine(location, nextLocation);
              }
          });

          const bounds = new google.maps.LatLngBounds();
          bounds.extend(lastLocation);
          if (bounds.getCenter().lat() !== 0 || bounds.getCenter().lng() !== 0) {
              map.fitBounds(bounds);
          }
      }
  }
</script>
<script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAcErlQMQKVQmqlnSmo9lIgEHp5e9MIjTE"
    ></script>
<!-- <script>
var deviceID = document.getElementById("currentdeviceID").innerText;
let isVehicleMovingOrNot = false;

$(document).ready(function () {
    $('#showButton').click(function () {
        const selectedDate = $('#datepicker').val();
        if (selectedDate) {
            updateExtData(selectedDate);
            updateGpsData(selectedDate);
        } else {
            console.log("Please select a date.");
        }
    });
});

function updateExtData(selectedDate) {
    $.ajax({
        url: `/ext-date-data/?deviceID={{deviceID}}&date=${selectedDate}`,
        type: "GET",
        success: function (data) {
            if (data && data.length > 0) {
                let lastEXTData = data[data.length - 1];
                $('#battery_voltage').text(lastEXTData["batt_voltage"]);
                $('#battery_amps').text(lastEXTData["batt_amp"]);
                $('#watt_hour').text(lastEXTData["watt_hr"]);
                $('#ext_speed').text(lastEXTData["speed"] + " Km/Hr");
                $('#battery_power').text(lastEXTData["batt_power"] + " Watt");
                $('#battery_capacity').text(lastEXTData["batt_capacity"]);
                let extSpeed = lastEXTData["speed"];
                let movementState = (extSpeed > 0) ? "Moving" : "Not Moving";
                $('#movementState_view').text(movementState);
            } else {
                console.log("No data available for the selected date.");
                $('#battery_voltage, #battery_amps, #watt_hour, #ext_speed, #battery_power, #battery_capacity, #movementState_view').text('');
            }
        },
        error: function (xhr, textStatus, errorThrown) {
            console.error("Error:", errorThrown);
        }
    });
}

function updateGpsData(selectedDate) {
    $.ajax({
        url: `/gps-date-data/?deviceID={{deviceID}}&date=${selectedDate}`,
        type: "GET",
        success: function (data) {
            if (data && data.length > 0) {
                let lastGPSData = data[data.length - 1];
                $('#ignition_state').text(lastGPSData["ignition"] ? "ON" : "OFF");
                let statusText;
                if (lastGPSData["ignition"]) {
                    if (isVehicleMovingOrNot) {
                        statusText = "Active";
                        $('#status_view').removeClass().addClass("status active-1");
                    } else {
                        statusText = "Idle";
                        $('#status_view').removeClass().addClass("status idle");
                    }
                } else {
                    statusText = isVehicleMovingOrNot ? "Alert" : "Inactive";
                    $('#status_view').removeClass().addClass("status " + (isVehicleMovingOrNot ? "alert" : "inactive"));
                }
                $('#status_view').text(statusText);
                $('#gsm_operator').text(lastGPSData["gsmOperatorCode"]);
                $('#gsm_signal').text(lastGPSData["gsmSignal"]);
                $('#gsm_area').text(lastGPSData["gsmAreaCode"]);
                $('#gps_speed').text(lastGPSData["speed"] + " Km/Hr");
                $('#gps_time').text('Current Time: ' + lastGPSData["time"]);
                $('#satellite_connect').text(lastGPSData["satellite"]);
                $('#latitude_view').text(lastGPSData["latitude"]);
                $('#longitude_view').text(lastGPSData["longitude"]);
            } else {
                console.log("No GPS data available for the selected date.");
                $('#ignition_state, #status_view, #gsm_operator, #gsm_signal, #gsm_area, #gps_speed, #gps_time, #satellite_connect, #latitude_view, #longitude_view').text('');
            }
        },
        error: function (xhr, textStatus, errorThrown) {
            console.error("Error:", errorThrown);
        }
    });
}
</script> -->
<!-- <script>
  $(document).ready(function () {
      $('#showButton').click(function () {
          const selectedDate = $('#datepicker').val();
          if (selectedDate) {
              fetchAndUpdateData(selectedDate);
          } else {
              console.log("Please select a date.");
          }
      });

      function fetchAndUpdateData(selectedDate) {
          $.ajax({
              url: "ext-date-data/?deviceID={{deviceID}}"+"&date="+selectedDate,
              type: "GET",
              success: function (data) {
                  if (data.length > 0) {
                      let lastEXTData = data[data.length - 1];
                      if (lastEXTData["batt_capacity"]) {
                          let batt_capacity = lastEXTData.batt_capacity;
                          updateBatteryBar(batt_capacity);
                      }
                  } else {
                      console.log("No data available for the selected date.");
                  }
              },
              error: function (xhr, textStatus, errorThrown) {
                  console.log("Error:", errorThrown);
              },
          });
      }

      function updateBatteryBar(batt_capacity) {
          let widthPercentage = (batt_capacity / 5) * 100;
          $('#battery_capacity').css('width', widthPercentage + '%');
      }
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var deviceID = document.getElementById("currentdeviceID").innerText;

    function updateGauge(date) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', "gps-date-data/?deviceID={{deviceID}}" + "&date=" + date, true);
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            var data = JSON.parse(xhr.responseText);
            var datacount = data.length;
            var lastGPSData = data[datacount - 1];
            document.getElementById('gps-data-conta').style.setProperty('--rotation', (lastGPSData.speed / 25 * 180) + 'deg');
            document.getElementById('gps_speed').textContent = lastGPSData.speed + ' Km/Hr';
          } else {
            console.log('Error:', xhr.statusText);
          }
        }
      };
      xhr.send();
    }

    document.getElementById('showButton').addEventListener('click', function () {
      var selectedDate = document.getElementById('datepicker').value;
      if (selectedDate) {
        updateGauge(selectedDate);
      } else {
        console.log('Please select a date.');
      }
    });
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var deviceID = document.getElementById("currentdeviceID").innerText;

    function updateGauge(date) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', "ext-date-data/?deviceID={{deviceID}}" + "&date=" + date, true);
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            var data = JSON.parse(xhr.responseText);
            if (data.length > 0) {
              var lastEXTData = data[data.length - 1];
              document.getElementById('ext-data-conta').style.setProperty('--rotation', (lastEXTData.speed / 25 * 180) + 'deg');
              document.getElementById('ext_batt').style.setProperty('--rotation', (lastEXTData.batt_power / 10000 * 180) + 'deg');
            } else {
              console.log('No data available for the selected date.');
            }
          } else {
            console.log('Error:', xhr.statusText);
          }
        }
      };
      xhr.send();
    }

    document.getElementById('showButton').addEventListener('click', function () {
      var selectedDate = document.getElementById('datepicker').value;
      if (selectedDate) {
        updateGauge(selectedDate);
      } else {
        console.log('Please select a date.');
      }
    });
  });
</script> -->
<!-- <script>
  document.addEventListener("DOMContentLoaded", function () {
      var deviceID = document.getElementById("currentdeviceID").innerText;

      function updateTopSpeed(date) {
          var xhr = new XMLHttpRequest();
          xhr.open('GET', "gps-date-data/?deviceID={{deviceID}}" + "&date=" + date, true);
          xhr.onreadystatechange = function () {
              if (xhr.readyState === 4) {
                  if (xhr.status === 200) {
                      var data = JSON.parse(xhr.responseText);
                      if (data.length > 0) {
                          var maxSpeed = calculateTopSpeed(data);
                          var rotation = (maxSpeed / 25 * 180) + 'deg';
                          document.getElementById('gps-data-conta').style.setProperty('--rotation', rotation);
                          document.getElementById('top-speed').textContent = maxSpeed + ' Km/Hr';
                      } else {
                          console.log('No data available for the selected date.');
                      }
                  } else {
                      console.log('Error:', xhr.statusText);
                  }
              }
          };
          xhr.send();
      }

      function calculateTopSpeed(data) {
          var maxSpeed = 0;
          for (var i = 0; i < data.length; i++) {
              var speed = data[i].speed;
              if (speed > maxSpeed) {
                  maxSpeed = speed;
              }
          }
          return maxSpeed;
      }

      document.getElementById('showButton').addEventListener('click', function () {
          var selectedDate = document.getElementById('datepicker').value;
          if (selectedDate) {
              updateTopSpeed(selectedDate);
          } else {
              console.log('Please select a date.');
          }
      });
  });
</script> -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    var deviceID = document.getElementById("currentdeviceID").innerText;
    var currentPage = 1;
    var totalPages = 0;

    function updateGPSTable(selectedDate, startTime, endTime, pageNumber) {
        var xhttp = new XMLHttpRequest();
        xhttp.onload = function () {
            var data = JSON.parse(this.responseText);
            var gpsTemplateString = "";
            if (data.length <= 0) {
                gpsTemplateString = "<tr> \
                                        <td colspan='7'>No Data</td>\
                                    </tr>";
            }

            for (var i = 0; i < data.length; i++) {
                var fieldData = data[i]["fields"];
                gpsTemplateString += "<tr> \
                                        <td>" + (i + 1) + "</td> \
                                        <td>" + fieldData['date'] + "</td> \
                                        <td>" + fieldData['time'] + "</td> \
                                        <td>" + fieldData['distance'] + "</td> \
                                        <td>" + fieldData['speed'] + "</td> \
                                        <td>" + fieldData['latitude'] + "</td> \
                                        <td>" + fieldData['longitude'] + "</td> \
                                     </tr>";
            }
            document.getElementById("gps_data_table").innerHTML = gpsTemplateString;
            console.log(fieldData);
        };
        var url = "updategpsdatetable?deviceID=" + deviceID + "&date=" + selectedDate + "&page=" + pageNumber;
        if (startTime && endTime) {
            url += "&startTime=" + startTime + "&endTime=" + endTime;
        }
        xhttp.open("GET", url, true);
        xhttp.send();
    }
    
    function updateGPSPaginationLinks() {
        var paginationLinks = document.getElementById("gps-pagination-links");
        paginationLinks.innerHTML = "";
        if (currentPage > 1) {
            paginationLinks.innerHTML += '<a href="#" data-page="1">&#129032; first</a>';
            paginationLinks.innerHTML += '<a href="#" data-page="' + (currentPage - 1) + '">&#9664;</a>';
        }
        paginationLinks.innerHTML += '<span class="current">Page ' + currentPage + ' of ' + totalPages + '</span>';
        if (currentPage < totalPages) {
            paginationLinks.innerHTML += '<a href="#" data-page="' + (currentPage + 1) + '">&#9654;</a>';
            paginationLinks.innerHTML += '<a href="#" data-page="' + totalPages + '">last &#129034;</a>';
        }

        var paginationLinksArray = paginationLinks.getElementsByTagName('a');
        for (var i = 0; i < paginationLinksArray.length; i++) {
            paginationLinksArray[i].addEventListener('click', function (event) {
                event.preventDefault();
                var nextPage = parseInt(this.getAttribute('data-page'));
                currentPage = nextPage;
                updateGPSTable(document.getElementById('datepicker').value, document.getElementById('fromTime').value, document.getElementById('toTime').value, nextPage);
                updateGPSPaginationLinks();
            });
        }
    }

    document.getElementById('showButton').addEventListener('click', function () {
        var selectedDate = document.getElementById('datepicker').value;
        var startTime = document.getElementById('fromTime').value;
        var endTime = document.getElementById('toTime').value;

        if (!selectedDate) {
            alert('Please select a date.');
            return;
        }
        if (!startTime) {
            alert('Please enter a start time.');
            return;
        }
        if (!endTime) {
            alert('Please enter an end time.');
            return;
        }
        if (startTime >= endTime) {
            alert('End time must be after start time.');
            return;
        }

        currentPage = 1;
        updateGPSTable(selectedDate, startTime, endTime, currentPage);
        totalPages = 999;
        updateGPSPaginationLinks();
    });
});
  </script>
  <script>
document.addEventListener("DOMContentLoaded", function () {
  var deviceID = document.getElementById("currentdeviceID").innerText;
  var currentPage = 1;
  var totalPages = 0;

  function updateEXTTable(selectedDate, startTime, endTime, pageNumber) {
      var xhttp = new XMLHttpRequest();
      xhttp.onload = function () {
          var data = JSON.parse(this.responseText);
          var extTemplateString = "";
          if (data.length <= 0) {
              extTemplateString = "<tr> \
                                      <td colspan='10'>No Data</td>\
                                  </tr>";
          }

          for (var i = 0; i < data.length; i++) {
              var fieldData = data[i]["fields"];
              extTemplateString += "<tr> \
                                      <td>" + (i + 1) + "</td> \
                                      <td>" + fieldData['date'] + "</td> \
                                      <td>" + fieldData['time'] + "</td> \
                                      <td>" + fieldData['distance'] + "</td> \
                                      <td>" + fieldData['speed'] + "</td> \
                                      <td>" + fieldData['watt_hr'] + "</td> \
                                      <td>" + fieldData['batt_voltage'] + "</td> \
                                      <td>" + fieldData['batt_amp'] + "</td> \
                                      <td>" + fieldData['batt_power'] + "</td> \
                                      <td>" + fieldData['batt_capacity'] + "</td> \
                                  </tr>";
          }
          document.getElementById("external_data_table").innerHTML = extTemplateString;
          console.log(fieldData);
      };
      var url = "updateextdatetable?deviceID=" + deviceID + "&date=" + selectedDate + "&page=" + pageNumber;
      if (startTime && endTime) {
          url += "&startTime=" + startTime + "&endTime=" + endTime;
      }
      xhttp.open("GET", url, true);
      xhttp.send();
  }

  function updateEXTPaginationLinks() {
      var paginationLinks = document.getElementById("ext-pagination-links");
      paginationLinks.innerHTML = "";
      if (currentPage > 1) {
          paginationLinks.innerHTML += '<a href="#" data-page="1">&#129032; first</a>';
          paginationLinks.innerHTML += '<a href="#" data-page="' + (currentPage - 1) + '">&#9664;</a>';
      }
      paginationLinks.innerHTML += '<span class="current">Page ' + currentPage + ' of ' + totalPages + '</span>';
      if (currentPage < totalPages) {
          paginationLinks.innerHTML += '<a href="#" data-page="' + (currentPage + 1) + '">&#9654;</a>';
          paginationLinks.innerHTML += '<a href="#" data-page="' + totalPages + '">last &#129034;</a>';
      }

      var paginationLinksArray = paginationLinks.getElementsByTagName('a');
      for (var i = 0; i < paginationLinksArray.length; i++) {
          paginationLinksArray[i].addEventListener('click', function (event) {
              event.preventDefault();
              var nextPage = parseInt(this.getAttribute('data-page'));
              currentPage = nextPage;
              updateEXTTable(document.getElementById('datepicker').value, document.getElementById('fromTime').value, document.getElementById('toTime').value, nextPage);
              updateEXTPaginationLinks();
          });
      }
  }

  document.getElementById('showButton').addEventListener('click', function () {
      var selectedDate = document.getElementById('datepicker').value;
      var startTime = document.getElementById('fromTime').value;
      var endTime = document.getElementById('toTime').value;

      if (!selectedDate) {
          alert('Please select a date.');
          return;
      }
      if (!startTime) {
          alert('Please enter a start time.');
          return;
      }
      if (!endTime) {
          alert('Please enter an end time.');
          return;
      }
      if (startTime >= endTime) {
          alert('End time must be after start time.');
          return;
      }

      currentPage = 1;
      updateEXTTable(selectedDate, startTime, endTime, currentPage);
      totalPages = 999;
      updateEXTPaginationLinks();
  });
});
</script>
</body>
</html>